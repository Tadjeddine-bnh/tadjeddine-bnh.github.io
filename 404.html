<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redirecting to App</title>
  <meta name="apple-itunes-app" content="app-id=6749378647">
  <script>
    const shouldRedirect = window.location.pathname.includes('/service/');

    if (shouldRedirect) {
      const pathSegments = window.location.pathname.split('/');
      const offerId = pathSegments[pathSegments.length - 1];
      
      const isAndroid = /Android/i.test(navigator.userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      
      if (isAndroid) {
        // Android App Link (keeps scheme=https because it's an intent parameter)
        window.location.href = `intent://tadjeddine-bnh.github.io/service/${offerId}#Intent;scheme=https;package=com.talla.app;end`;
        
        setTimeout(function() {
          window.location.href = "https://play.google.com/store/apps/details?id=com.talla.app";
        }, 2000);
        
      } else if (isIOS) {
        let attempted = false;
        
        // iOS Custom Scheme (NO nested https://)
        const customSchemeUrl = `com.talla.app://service/${offerId}`;
        window.location.href = customSchemeUrl;
        
        // Fallback to Universal Link
        setTimeout(function() {
          if (!attempted) {
            attempted = true;
            window.location.href = `https://tadjeddine-bnh.github.io/service/${offerId}`;
          }
        }, 500);
        
        // Final fallback to App Store
        setTimeout(function() {
          if (!attempted) {
            window.location.href = "https://apps.apple.com/sa/app/talla-%D8%B7%D9%84%D8%A9/id6749378647";
          }
        }, 3000);
        
      } else {
        window.location.href = `https://talla.sa`;
      }
    } else {
      window.location.href = "https://talla.sa";
    }
  </script>
</head>
<body>
  <p>
    Redirecting to app...<br>
    <small>If the app doesn't open, <a href="https://talla.sa">click here</a></small>
  </p>
</body>
</html>
